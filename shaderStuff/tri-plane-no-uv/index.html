<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html" charset="utf-8"/>
    <title>Tri-Plane Shader</title>
	<script src="https://preview.babylonjs.com/babylon.js"></script>
	
	<style>
		html, body {
            overflow: hidden;
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
        }

        #renderCanvas {
            width: 100%;
            height: 100%;
            touch-action: none;
        }
	</style>

	
	
</head>
<body>
<canvas id="renderCanvas"></canvas>
</body>

<script>



document.addEventListener("DOMContentLoaded", () => {
var canvas = document.getElementById('renderCanvas');			
var engine = new BABYLON.Engine(canvas, true);

var createScene = function () {
    var scene = new BABYLON.Scene(engine);
    var camera = new BABYLON.FreeCamera("camera1", new BABYLON.Vector3(0, 5, -10), scene);
    camera.setTarget(BABYLON.Vector3.Zero());
    camera.attachControl(canvas, true);
    var light = new BABYLON.HemisphericLight("light1", new BABYLON.Vector3(0, 1, 0), scene);
    light.intensity = 0.7;
    
	camera.speed = 0.5;
	camera.minZ = 0.0001;
	
	
	
	var shader = new BABYLON.ShaderMaterial("tpShader", scene, {
					vertex: "tpMain",
					fragment: "tpMain",
					},{
					attributes: ["position", "normal", "uv", "color"],
					defines: [],
					samplers: ['texture0'],
					uniforms: ["world",
					"worldView", 
					"worldViewProjection",
					"view"]
	});
				
	var texture0 = new BABYLON.Texture('./wood_preview.jpeg', scene, false, false, 1, (e)=>{
		shader.setTexture("texture0", texture0);
		console.log(texture0);
		shader.setVector2("textureSize", new BABYLON.Vector2(texture0._texture.baseWidth, texture0._texture.baseHeight));
	});	

	BABYLON.SceneLoader.Append("./", "RGB-Mapping.babylon", scene, (e)=>{
		for(var i =0; i<e.meshes.length; i++){
			e.meshes[i].material = shader;
		}
	});	
	
	
	
    return scene;
};

	var scene = createScene();
		
		window.addEventListener("resize",()=>{				
			engine.resize();
		});
		
		engine.runRenderLoop(()=>{
			scene.render(); 
		});		
		
},false);




var _vs = 
`precision highp float;
// Attributes
attribute vec3 position;
attribute vec3 normal;
attribute vec2 uv;
attribute vec4 color;
// Uniforms
uniform mat4 worldViewProjection;

varying vec3 vPosition;
varying vec2 vUV;
varying vec4 vColor;



void main() {
    vec4 p = vec4( position, 1. );    
	vPosition = p.xyz;	
	gl_Position = worldViewProjection * p;	
	vUV = uv;
	vColor = color;
}`;

var _fs = 
`precision highp float;

varying vec3 vPosition;
varying vec2 vUV;
varying vec4 vColor;
uniform sampler2D texture0;

uniform vec2 textureSize;

uniform vec3 rChannel;
uniform vec3 gChannel;
uniform vec3 bChannel;

void main(){	

	vec3 color = vec3(1.0);
	float alpha = 1.0;
	
	vec2 reSize = vec2(3.0, 1.);
	
	
	if(vColor.r > 0.){
		color = texture2D(texture0, vPosition.zx*reSize).rgb;
	}else if(vColor.g > 0.){
		color = texture2D(texture0, vPosition.zy*reSize.xy).rgb;
	}else if(vColor.b > 0.){
		color = texture2D(texture0, vPosition.xy*reSize.xy).rgb;
	}

	gl_FragColor =  vec4(color, alpha);
}
`;

BABYLON.Effect.ShadersStore["tpMainVertexShader"] = _vs;
BABYLON.Effect.ShadersStore["tpMainFragmentShader"] = _fs;




</script>


</html>
